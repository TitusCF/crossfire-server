<html>
<head>
<title>Crossfire World Map</title>
</head>
<body>
<p>This is a zoomable Crossfire world map based on <a href='https://openseadragon.github.io/'>OpenSeaDragon</a>. To use this world map:</p>
<ol>
    <li><a href='https://openseadragon.github.io/#download'>Download OpenSeaDragon</a> and extract it to <i>openseadragon/</i> in this directory
    <li>Generate world maps in JPG mode by running <i>./crossfire-mapper -jpg</i>
</ol>
<div id="cf_world_map" style="width: 100%; height: 100%;"></div>
<script src="openseadragon/openseadragon.min.js"></script>
<script type="text/javascript">
    /* world parameters */
    var worldTileSize = 50;
    var mapTiles = 30;

    /* crossfire-mapper parameters */
    var genLevels = 5;  // largest map scale generated from crossfire-mapper (num_sizes)
    var maxLevel = 5;   // largest (OpenSeaDragon) map scale to display
    var tileSize = 32;

    /**
     * Zoom levels generated by crossfire-mapper are inverted with respect to
     * OpenSeaDragon zoom levels. Convert their level to our level.
     */
    function fileLevel(level) {
        return genLevels + 1 - level;
    }

    /**
     * Return width (equal to height) of map at the given OpenSeaDragon level.
     */
    function imgSize(level) {
        return tileSize*worldTileSize/Math.pow(2, fileLevel(level)-1);
    }

    var maxRes = imgSize(maxLevel);

    var viewer = OpenSeadragon({
        id: "cf_world_map",
        prefixUrl: "openseadragon/images/",
        animationTime: 0.5,
        zoomPerScroll: 1.4,
        tileSources: {
            width: maxRes * mapTiles,
            height: maxRes * mapTiles,
            tileSize: maxRes / maxLevel,
            minLevel: 1,
            maxLevel: maxLevel,
            getTileUrl: function(level, x, y) {
                return "html/world/world_" + (x+100) + "_" + (y+100) + ".x" + fileLevel(level) + ".jpg"
            },
            getTileWidth: function(level) {
                return imgSize(level);
            },
            getTileHeight: function(level) {
                return imgSize(level);
            }
        }
    });
</script>
</body>
</html>
